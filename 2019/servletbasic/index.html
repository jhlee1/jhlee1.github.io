<!DOCTYPE html>
<html lang="en-us">
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Code Repository  | ServletBasic</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bulma/0.7.1/css/bulma.min.css" />
    <link rel="stylesheet" href="https://jhlee1.github.io/css/blog.css" />
    
</head>
<body>

    
    <nav class="navbar is-fixed-top" role="navigation" aria-label="main navigation">
        <div class="navbar-brand">
            <a class="navbar-item" href="https://jhlee1.github.io/">Home</a>
        </div>
    </nav>
    

    
    <section class="hero is-info is-medium">
        <div class="hero-body" style="background-image: url(https://jhlee1.github.io/img/bg-blog.jpg);">
            <div class="container has-text-centered">
                <br>
                <h1 class="title is-size-1">
                    
                        ServletBasic
                    
                </h1>
                
            </div>
        </div>
    </section>


<div class="container">
    <div class="section">
    

<div class="columns">
    <div class="column is-9">
        <div class="tile is-child box">
            <div class="content">
                <ol>
<li><p>Java Web Application의 폴더 구조</p>

<ul>
<li>WEB-INF가 반드시 존재해야됨</li>
<li>Servlet 3.0미만에선 web.xml이 필수적으로 있어야함. 이후 버전에는 annotation을 이용함</li>
</ul></li>

<li><p>eclipse plugin</p>

<ul>
<li>eclipse의 workspace안에 .metadata/.plugins/org.eclipse.wst.server.core/tmp0을 열어보면 Tomcat과 비슷 구조이다.</li>
<li>eclipse 내부적으로 Tomcat을 사용할 때 필요한 부분을 가져와서 쓴다고 생각하면 됨</li>
<li>wtpwebapps를 열어보면 여태까지 실습한 내용이 들어있음</li>
</ul></li>

<li><p>Servlet이란?</p>

<ul>
<li>Java Web Application의 구성요소 중 동적 처리를 맡음</li>
<li>WAS에서 동작하는 Java class이다.</li>
<li>HttpServlet class를 상속받아야한다</li>
<li>Servlet과 JSP로 최상의 결과를 얻으려면 조화롭게 사용해야 한다 (HTML은 JSP로, 복잡한 로직은 Servlet으로 처리)</li>
</ul></li>

<li><p>Servlet 작동원리</p>

<ul>
<li>Servlet 버전이 3.0 미만의 경우</li>
<li>Servlet이 생성될 때마다 web.xml에 등록을 해줘야됨</li>
<li>web.xml 파일의 <servlet-mapping>에서 해당 url이 존재하는지 찾아보고 없으면 404 있으면 Servlet으로 맵핑됨</li>
</ul></li>
</ol>

<p>ex)</p>

<pre><code class="language-xml">&lt;servlet&gt;
    &lt;description&gt;&lt;/description&gt;
    &lt;display-name&gt;TenServlet&lt;/display-name&gt;
    &lt;servlet-name&gt;TenServlet&lt;/servlet-name&gt;
    &lt;servlet-class&gt;eaxmple.TenServlet&lt;/servlet-class&gt;
  &lt;/servlet&gt;
  &lt;servlet-mapping&gt;
    &lt;servlet-name&gt;TenServlet&lt;/servlet-name&gt;
    &lt;url-pattern&gt;/ten&lt;/url-pattern&gt;
  &lt;/servlet-mapping&gt;
</code></pre>

<p>3.0 이상의 경우엔 위의 과정이 아래 방식처럼 Annotation으로 처리됨</p>

<pre><code class="language-java">@WebServlet(&quot;/ten&quot;)
</code></pre>

<ol>
<li>Life Cycle of Servlet

<ul>
<li>Request가 왔을 때 WAS에서는 해당 Request를 처리할 Servlet이 있는지 검사</li>
<li>없는 경우, Sevlet 객체를 생성 후 service가 불려짐(LifeCycleServlet() -&gt; init() -&gt; service())</li>
<li>이미 객체가 존재하는 경우 service만 불림(service())</li>
<li>destroy의 경우 WAS가 종료되거나 Web Applicaiton이 새롭게 갱신될 경우 불려진다.</li>
<li>Servlet의 내용이 업데이트 된 경우 이미 생성된 Servlet 객체는 삭제되고 새롭게 생성됨 (destroy() -&gt; LifeCycleServlet() -&gt; init() -&gt; service())</li>
</ul></li>
</ol>

<pre><code class="language-java">@WebServlet(&quot;/LifecycleServlet&quot;)
public class LifecycleServlet extends HttpServlet {
    private static final long serialVersionUID = 1L;

    public LifecycleServlet() {
        //        super();
        System.out.println(&quot;Lifecycle Servlet is created.&quot;);
    }

    public void init(ServletConfig config) throws ServletException {
        System.out.println(&quot;init method is called.&quot;);
        System.out.println(&quot;init is changed.&quot;); // 먼저 요청을 보내 LifecycleServlet 객체가 생성된 이후에 해당 라인 추가
    }

    public void destroy() {
        System.out.println(&quot;destroy method is called.&quot;);
    }

    protected void service(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
        System.out.println(&quot;service method is called.&quot;);
    }
}
</code></pre>

<ol>
<li><p>service(request, response) 메소드</p>

<ul>
<li>HttpServlet의 service 메소드는 템플릿 메소드 패턴으로 구현</li>
<li>클라이언트의 요청이 GET일 경우 자신이 가지고 있는 doGet(request, response)를 호출</li>
<li>클라이언트의 요청이 POST일 경우 자신이 가지고 있는 doPost(request, response)를 호출</li>
<li>PUT, DELETE도 마찬가</li>
</ul></li>

<li><p>HttpServletRequest, HttpServletResponse</p>

<ul>
<li>WAS는 웹 브라우저로부터 Servlet Request를 받으면,</li>
<li>요청할 때 가지고 있는 정보를 HttpServletRequest 객체를 생성하여 저장</li>
<li>웹 브라우저에게 응답을 보낼 때 사용하기 위하여 HttpServletResponse 객체를 생성</li>
<li>생성된 HttpServletRequest, HttpServletResponse 객체를 Servlet에게 전달</li>
<li>HttpServletRequest</li>
<li>http protocol의 request 정보를 servlet에게 전달하기 위한 목적으로 사용</li>
<li>header, parameter, cookies, URI, URL 등의 정보를 읽어 들이는 method를 가지고 있다.</li>
<li>Body의 Stream을 읽어 들이는 method를 가지고 있다.</li>
<li>HttpServletResponse</li>
<li>WAS는 어떤 클라이언트가 요청을 보냈는지 알고 있고, 해당 클라이언트에게 응답을 보내기 위한 HttpServletResponse 객체를 생성해서 Servlet에게 전달</li>
<li>Servlet은 해당 객체를 이용해서 Content Type, Response code, Response message 등을 전송</li>
</ul></li>

<li><p>forward</p>

<ul>
<li>redirect의 경우 Client에서 Request를 두 번 보낸다.(302 reponse를 받고 다시 Request 보냄)</li>
<li>하지만, forward의 경우엔 한 번의 Request와 Response만 존재함(Server안의 Servlet끼리 넘기는 방식이기 때문에)</li>
<li>진행방식</li>
<li>웹 브라우저에서 Servlet1에게 요청을 보냄</li>
<li>Servlet1은 요청을 처리한 후, 그 결과를 HttpServletRequest에 저장</li>
<li>Servlet1은 결과가 저장된 HttpServletRequest와 응답을 위한 HttpServletResponse를 같은 웹 어플리케이션 안에 있는 Servlet2에게 전송(forward)</li>
<li>Servlet2는 Servlet1으로 부터 받은 HttpServletRequest와 HttpServletResponse를 이용하여 요청을 처리한 후 웹 브라우저에게 결과를 전송</li>
</ul></li>
</ol>

<p>ex)
FrontServlet.java</p>

<pre><code class="language-Java">package examples;

import java.io.IOException;

import javax.servlet.RequestDispatcher;
import javax.servlet.ServletException;
import javax.servlet.annotation.WebServlet;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

/**
 * Servlet implementation class FrontServlet
 */
@WebServlet(&quot;/front&quot;)
public class FrontServlet extends HttpServlet {
    private static final long serialVersionUID = 1L;

    /**
     * @see HttpServlet#HttpServlet()
     */
    public FrontServlet() {
        super();
        // TODO Auto-generated constructor stub
    }

    /**
     * @see HttpServlet#service(HttpServletRequest request, HttpServletResponse response)
     */
    protected void service(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {

            int diceValue = (int)(Math.random() * 6) + 1;
            request.setAttribute(&quot;dice&quot;, diceValue);

            RequestDispatcher requestDispatehcer = request.getRequestDispatcher(&quot;/next&quot;);
            requestDispatehcer.forward(request, response);
    }

}
</code></pre>

<p>NextServlet.java</p>

<pre><code class="language-Java">package examples;

import java.io.IOException;
import java.io.PrintWriter;
import java.util.Enumeration;

import javax.servlet.ServletException;
import javax.servlet.annotation.WebServlet;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

/**
 * Servlet implementation class NextServlet
 */
@WebServlet(&quot;/next&quot;)
public class NextServlet extends HttpServlet {
    private static final long serialVersionUID = 1L;

    /**
     * @see HttpServlet#HttpServlet()
     */
    public NextServlet() {
        super();
        // TODO Auto-generated constructor stub
    }

    /**
     * @see HttpServlet#service(HttpServletRequest request, HttpServletResponse response)
     */
    protected void service(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
        response.setContentType(&quot;text/html&quot;);
        PrintWriter out = response.getWriter();
        out.println(&quot;&lt;html&gt;&quot;);
        out.println(&quot;&lt;head&gt;&lt;title&gt;form&lt;/title&gt;&lt;/head&gt;&quot;);
        out.println(&quot;&lt;body&gt;&quot;);

        int dice = (Integer)request.getAttribute(&quot;dice&quot;);
        out.println(&quot;dice : &quot; + dice);
        for(int i = 0; i &lt; dice; i++) {
            out.print(&quot;&lt;br&gt;hello&quot;);
        }
        out.println(&quot;&lt;/body&gt;&quot;);
        out.println(&quot;&lt;/html&gt;&quot;);
    }
}

</code></pre>

<ol>
<li>Servlet과 JSP 연동

<ul>
<li>로직 수행은 Servlet에서, 화면 표시는 JSP에서 하는 것이 유리하기 때문에 Servlet에서 프로그램 로직을 수행하고, 그 결과를 JSP에게 forward처리</li>
</ul></li>
</ol>

<p>ex)</p>

<pre><code class="language-Java">package examples;

import java.io.IOException;

import javax.servlet.RequestDispatcher;
import javax.servlet.ServletException;
import javax.servlet.annotation.WebServlet;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

/**
 * Servlet implementation class LogicServlet
 */
@WebServlet(&quot;/LogicServlet&quot;)
public class LogicServlet extends HttpServlet {
    private static final long serialVersionUID = 1L;

    public LogicServlet() {
        super();
    }

    protected void service(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
        int v1 = (int)(Math.random() * 100) + 1;
        int v2 = (int)(Math.random() * 100) + 1;
        int result = v1 + v2;

        request.setAttribute(&quot;v1&quot;, v1);
        request.setAttribute(&quot;v2&quot;, v2);
        request.setAttribute(&quot;result&quot;, result);

        RequestDispatcher requestDispatcher = request.getRequestDispatcher(&quot;/result.jsp&quot;);
        requestDispatcher.forward(request, response);
    }
}
</code></pre>

<p>result.jsp</p>

<pre><code class="language-java">&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=UTF-8&quot;
    pageEncoding=&quot;UTF-8&quot;%&gt;
&lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD HTML 4.01 Transitional//EN&quot; &quot;http://www.w3.org/TR/html4/loose.dtd&quot;&gt;
&lt;html&gt;
&lt;head&gt;
&lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=UTF-8&quot;&gt;
&lt;title&gt;Insert title here&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
EL표기법&lt;br&gt;
${v1} + ${v2} = ${result} &lt;br&gt;&lt;br&gt;

Scriptlet과 Expression을 이용해 출력합니다.&lt;br&gt;
&lt;%
    int v1 = (int)request.getAttribute(&quot;v1&quot;);
    int v2 = (int)request.getAttribute(&quot;v2&quot;);
    int result = (int)request.getAttribute(&quot;result&quot;);
%&gt;

&lt;%=v1%&gt; + &lt;%=v2 %&gt; = &lt;%=result %&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre>

<ol>
<li><p>Scope 범위</p>

<ul>
<li>Application scope: 웹 어플리케이션이 시작되고 종료될 때까지 변수가 유지되는 경우 사용</li>
<li>Session scope : 웹 브라우저 별로 변수가 관리되는 경우 사용</li>
<li>Request scope : http요청을 WAS가 받아서 웹 브라우저에게 응답할 때까지 변수가 유지되는 경우 사용</li>
<li>Page scope: 페이지 내에서 지역변수처럼 사용</li>
<li>위 scope들의 사용 방법은 모두 같다.

<ul>
<li>값을 저장할 때는 request 객체의 setAttribute()메소드를 사용한다.</li>
<li>값을 읽어 들일 때는 request 객체의 getAttribute()메소드를 사용한다.</li>
</ul></li>
</ul></li>

<li><p>Page scope</p>

<ul>
<li>해당 Servlet이나 JSP이 실행되는 동안만 유지하려고 할 때 사용됨</li>
<li>PageContext라는 Abstract class를 이용</li>
<li>JSP 페이지 내에 pageContext라는 내장 객체 사용</li>
<li>forward할 경우 page scope 안의 context는 넘길 수 없다.</li>
<li>jsp에서 pageScope에 값을 저장한 후 해당 값을 EL표기법으로 사용할 때 자주 이용됨</li>
</ul></li>

<li><p>Request scope</p>

<ul>
<li>HTTP Request를 받아서 Response를 보낼 때까지 변수값을 유지하고자 할 경우 사용한다.</li>
<li>HttpServletRequest 객체를 사용한다.</li>
<li>JSP에서는 request 내장 변수를 사용한다.</li>
<li>서블릿에서는 HttpServletRequest 객체를 사용한다.</li>
<li>forward 시 값을 유지하고자 사용한다.</li>
<li>앞에서 forward에 대하여 배울 때 forward 하기 전에 request 객체의 setAttribute() 메소드로 값을 설정한 후, 서블릿이나 jsp에게 결과를 전달하여 값을 출력하도록 하였는데 이렇게 포워드 되는 동안 값이 유지되는 것이 Request scope를 이용했다고 합니다.</li>
</ul></li>

<li><p>Session scope</p>

<ul>
<li>Browser에 따라 변수를 관리하고자 할 경우 사용한다.</li>
<li>Browser의 Tab 간에는 세션정보가 공유되기 때문에, 각각의 탭에서는 같은 세션정보를 사용할 수 있다.</li>
<li>HttpSession 인터페이스를 구현한 객체를 사용한다.</li>
<li>JSP에서는 session 내장 변수를 사용한다.</li>
<li>서블릿에서는 HttpServletRequest를 사용한다.</li>
<li>장바구니처럼 사용자별로 유지가 되어야 할 정보가 있을 때 사용한다.</li>
</ul></li>

<li><p>Application scope</p>

<ul>
<li>Web Application이 시작되고 종료될 때까지 하나의 application객체가 사용된다.</li>
<li>ServletContext 인터페이스를 구현한 객체를 사용한다.</li>
<li>jsp에서는 application 내장 객체를 이용한다.</li>
<li>Servlet에서는 getServletContext()메소드를 이용하여 application객체를 이용한다.</li>
<li>모든 클라이언트가 공통으로 사용해야 할 값들이 있을 때 사용한다.</li>
</ul></li>
</ol>

<p>ex)
ApplicationScope01.java</p>

<pre><code class="language-java">package examples;

import java.io.IOException;
import java.io.PrintWriter;

import javax.servlet.ServletContext;
import javax.servlet.ServletException;
import javax.servlet.annotation.WebServlet;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

@WebServlet(&quot;/ApplicationScope01&quot;)
public class ApplicationScope01 extends HttpServlet {
    private static final long serialVersionUID = 1L;

    public ApplicationScope01() {
        super();
    }

    protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
        response.setContentType(&quot;text/html; charset=UTF-8&quot;);

        PrintWriter out = response.getWriter();
        ServletContext application = getServletContext();
        int value = 1;

        application.setAttribute(&quot;value&quot;, value);
        out.println(&quot;&lt;h1&gt;value : &quot; + value + &quot;&lt;/h1&gt;&quot;);
    }
}
</code></pre>

<p>ApplicationScope02.java</p>

<pre><code class="language-Java">package examples;

import java.io.IOException;
import java.io.PrintWriter;

import javax.servlet.ServletContext;
import javax.servlet.ServletException;
import javax.servlet.annotation.WebServlet;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

/**
 * Servlet implementation class ApplicationScope01
 */
@WebServlet(&quot;/ApplicationScope02&quot;)
public class ApplicationScope02 extends HttpServlet {
    private static final long serialVersionUID = 1L;

    /**
     * @see HttpServlet#HttpServlet()
     */
    public ApplicationScope02() {
        super();
        // TODO Auto-generated constructor stub
    }

    /**
     * @see HttpServlet#doGet(HttpServletRequest request, HttpServletResponse response)
     */
    protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
        response.setContentType(&quot;text/html; charset=UTF-8&quot;);

        PrintWriter out = response.getWriter();

        ServletContext application = getServletContext();


        try {
            int value = (int)application.getAttribute(&quot;value&quot;);
            value++;
            application.setAttribute(&quot;value&quot;, value);
            out.println(&quot;&lt;h1&gt;value : &quot; + value + &quot;&lt;/h1&gt;&quot;);
        }catch(NullPointerException ex) {
            out.println(&quot;value is not found.&quot;);
        }


    }

}
</code></pre>

<p>ApplicationScope01.jsp</p>

<pre><code class="language-html">&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=UTF-8&quot;
    pageEncoding=&quot;UTF-8&quot;%&gt;
&lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD HTML 4.01 Transitional//EN&quot; &quot;http://www.w3.org/TR/html4/loose.dtd&quot;&gt;
&lt;html&gt;
&lt;head&gt;
&lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=UTF-8&quot;&gt;
&lt;title&gt;Insert title here&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;%
    try{
        int value = (int)application.getAttribute(&quot;value&quot;);
        value = value + 2;
        application.setAttribute(&quot;value&quot;, value);
%&gt;
        &lt;h1&gt;&lt;%=value %&gt;&lt;/h1&gt;
&lt;%        
    }catch(NullPointerException ex){
%&gt;
        &lt;h1&gt;설정된 값이 없습니다.&lt;/h1&gt;
&lt;%        
    }
%&gt;

&lt;/body&gt;
&lt;/html&gt;
</code></pre>

            </div>
        </div>
    </div>
    <div class="column is-3">
        <div class="card">
    <div class="card-content">
        <h1 class="title is-5">Tags</h1>
        <div class="tags">
        
            <span class="tag"><a href="https://jhlee1.github.io/tags/edwith">edwith</a></span>
        
            <span class="tag"><a href="https://jhlee1.github.io/tags/javascript">javascript</a></span>
        
            <span class="tag"><a href="https://jhlee1.github.io/tags/need-to-read">need-to-read</a></span>
        
            <span class="tag"><a href="https://jhlee1.github.io/tags/random">random</a></span>
        
        </div>          
    </div>
</div><br>
        <div class="card">
    <div class="card-content">
        <h1 class="title is-5">Recent posts</h1>
        
            <h1><a href="https://jhlee1.github.io/2019/jspbasic/">JspBasic</a></h1>
            <time class="has-text-grey-light is-size-7">6 February 2019</time>
        
            <h1><a href="https://jhlee1.github.io/2019/javascriptbasic/">JavascriptBasic</a></h1>
            <time class="has-text-grey-light is-size-7">31 January 2019</time>
        
            <h1><a href="https://jhlee1.github.io/2019/servletbasic/">ServletBasic</a></h1>
            <time class="has-text-grey-light is-size-7">30 January 2019</time>
        
            <h1><a href="https://jhlee1.github.io/2019/links-to-read/">Links to Read</a></h1>
            <time class="has-text-grey-light is-size-7">29 January 2019</time>
        
            <h1><a href="https://jhlee1.github.io/2019/my-first-post/">My First Post</a></h1>
            <time class="has-text-grey-light is-size-7">29 January 2019</time>
        
    </div>
</div>
    <br>
                
  



<div class="card">
    <div class="card-content">
        <h1 class="title is-5">Related posts</h1>
      
      
            <h1><a href="https://jhlee1.github.io/2019/jspbasic/">JspBasic</a></h1>
            <time class="has-text-grey-light is-size-7">6 February 2019</time>
      
    </div>
</div>

    
<br>
        <div class="card">
    <div class="card-content">
        <h1 class="title is-5">Archives</h1>
        
            <a href="https://jhlee1.github.io/archives/2019">2019</a> (5)<br>
        
    </div>
</div>

    </div>
</div>


    </div>
</div>

<footer class="footer has-background-grey-darker has-text-white">
    <div class="content has-text-centered">
        <p>
            <span class="icon is-large"><a href="https://twitter.com/" class="mysocial"><i class="fab fa-twitter fa-3x"></i></a></span>&nbsp;&nbsp;
            <span class="icon is-large"><a href="https://www.youtube.com/" class="mysocial"><i class="fab fa-youtube fa-3x"></i></a></span>&nbsp;&nbsp;
            <span class="icon is-large"><a href="https://github.com/" class="mysocial"><i class="fab fa-github fa-3x"></i></a></span>&nbsp;&nbsp;
            <br><br>
            Copyright &copy; Code Repository 2019 - Theme by <a href="https://jeffprod.com" class="mysocial">JeffProd.com</a>
            - <a class="mysocial" href="https://jhlee1.github.io/about">About</a>
        </p>
    </div>
</footer>

<script defer src="https://use.fontawesome.com/releases/v5.1.0/js/all.js"></script>
</body>
</html>
